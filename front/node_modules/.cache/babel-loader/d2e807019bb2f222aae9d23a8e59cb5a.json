{"ast":null,"code":"var _jsxFileName = \"/home/omar/codi/final/front/src/components/session/SessionProvider.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport SessionContext from \"./SessionContext\";\nimport { setCookie, getCookie, removeCookie } from \"../../cookies\";\nimport { toast } from \"react-toastify\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function SessionProvider({\n  children\n}) {\n  _s();\n\n  const [session, setValue] = useState({\n    user: {\n      token: getCookie(\"token\")\n    }\n  });\n  useEffect(() => {\n    function initializeSession() {\n      let id = getCookie(\"id\");\n      let token = getCookie(\"token\");\n      if (token) fetch(`http://127.0.0.1:8000/api/user`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      }).then(res => res.json()).then(res => {\n        let user = { ...res,\n          token\n        };\n        updateSession({\n          user\n        });\n      });\n    }\n\n    initializeSession();\n  }, []);\n\n  function updateSession(nextSession) {\n    let value = typeof nextSession === \"function\" ? nextSession : prevSession => ({ ...prevSession,\n      ...nextSession\n    });\n    setValue(value);\n  }\n\n  async function login({\n    email,\n    password\n  }) {\n    // try to login\n    let {\n      error,\n      id = 4,\n      token\n    } = await fetch(\"http://127.0.0.1:8000/api/login\", {\n      method: \"post\",\n      headers: {\n        \"Content-type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        email,\n        password\n      })\n    }).then(res => res.json()); // return from the function if you have an error\n\n    if (error || !token) return toast.error(error); // get the data of the loggedin user\n\n    let result = await fetch(`http://127.0.0.1:8000/api/user`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    }).then(res => res.json());\n    let user = { ...result,\n      token\n    };\n    setCookie(\"id\", id);\n    setCookie(\"token\", token);\n    updateSession({\n      user\n    });\n    toast(`Welcome ${user.name}!`);\n  }\n\n  function logout() {\n    updateSession({\n      user: {\n        token: null\n      }\n    });\n    removeCookie(\"id\");\n    removeCookie(\"token\");\n  }\n\n  function register(email, username, password) {\n    console.log(email, username, password);\n  }\n\n  const context = {\n    session,\n    actions: {\n      login,\n      logout,\n      register\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(SessionContext.Provider, {\n    value: context,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 91,\n    columnNumber: 5\n  }, this);\n}\n\n_s(SessionProvider, \"M9P9VDmi5utHOnIGK4LsM8hHwII=\");\n\n_c = SessionProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"SessionProvider\");","map":{"version":3,"sources":["/home/omar/codi/final/front/src/components/session/SessionProvider.js"],"names":["React","useState","useEffect","SessionContext","setCookie","getCookie","removeCookie","toast","SessionProvider","children","session","setValue","user","token","initializeSession","id","fetch","headers","Authorization","then","res","json","updateSession","nextSession","value","prevSession","login","email","password","error","method","body","JSON","stringify","result","name","logout","register","username","console","log","context","actions"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport SessionContext from \"./SessionContext\";\nimport { setCookie, getCookie, removeCookie } from \"../../cookies\";\nimport { toast } from \"react-toastify\";\n\nexport default function SessionProvider({ children }) {\n  const [session, setValue] = useState({\n    user: {\n      token: getCookie(\"token\"),\n    },\n  });\n\n  useEffect(() => {\n    function initializeSession() {\n      let id = getCookie(\"id\");\n      let token = getCookie(\"token\");\n      if (token)\n        fetch(`http://127.0.0.1:8000/api/user`, {\n          headers: {\n            Authorization: `Bearer ${token}`,\n        },\n        })\n          .then((res) => res.json())\n          .then((res) => {\n            let user = { ...res, token };\n            updateSession({ user });\n          });\n    }\n    initializeSession();\n  }, []);\n\n  function updateSession(nextSession) {\n    let value =\n      typeof nextSession === \"function\"\n        ? nextSession\n        : (prevSession) => ({ ...prevSession, ...nextSession });\n    setValue(value);\n  }\n\n  async function login({ email, password }) {\n    // try to login\n    let {\n      error,\n      id = 4,\n      token,\n    } = await fetch(\"http://127.0.0.1:8000/api/login\", {\n      method: \"post\",\n      headers: {\n        \"Content-type\": \"application/json\",\n      },\n      body: JSON.stringify({ email, password }),\n    }).then((res) => res.json());\n\n    // return from the function if you have an error\n    if (error || !token) return toast.error(error);\n\n    // get the data of the loggedin user\n    let result = await fetch(`http://127.0.0.1:8000/api/user`, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n    }).then((res) => res.json());\n\n    let user = { ...result, token };\n\n    setCookie(\"id\", id);\n    setCookie(\"token\", token);\n    updateSession({ user });\n    toast(`Welcome ${user.name}!`);\n  }\n\n  function logout() {\n    updateSession({ user: { token: null } });\n    removeCookie(\"id\");\n    removeCookie(\"token\");\n  }\n  function register(email, username, password) {\n    console.log(email, username, password);\n  }\n\n  const context = {\n    session,\n    actions: {\n      login,\n      logout,\n      register,\n    },\n  };\n\n  return (\n    <SessionContext.Provider value={context}>\n      {children}\n    </SessionContext.Provider>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}