{"ast":null,"code":"var _jsxFileName = \"/home/omar/codi/final/front/src/components/session/SessionProvider.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport SessionContext from \"./SessionContext\";\nimport { setCookie, getCookie, removeCookie } from \"../../cookies\";\nimport { toast } from \"react-toastify\";\nimport axios from \"axios\";\nimport { Redirect } from \"react-router\";\nimport sessionapi from '../API/sessionapi';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function SessionProvider({\n  children\n}) {\n  _s();\n\n  let token = getCookie(\"token\");\n  const [loggedin, setLoggedin] = useState(false);\n  const [session, setValue] = useState({\n    user: {\n      token: getCookie(\"token\")\n    }\n  });\n  useEffect(() => {\n    function initializeSession() {\n      let token = getCookie(\"token\");\n      if (token) fetch(`${sessionapi}api/user`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      }).then(res => res.json()).then(res => {\n        if (!res) {\n          return /*#__PURE__*/_jsxDEV(Redirect, {\n            to: \"/account\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 30,\n            columnNumber: 22\n          }, this);\n        }\n\n        let role = res.role;\n        let user = { ...res,\n          token,\n          role\n        };\n        setLoggedin(true);\n        updateSession({\n          user\n        });\n      });\n    }\n\n    initializeSession();\n  }, [token]);\n\n  function updateSession(nextSession) {\n    let value = typeof nextSession === \"function\" ? nextSession : prevSession => ({ ...prevSession,\n      ...nextSession\n    });\n    setValue(value);\n  }\n\n  async function login({\n    email,\n    password\n  }) {\n    try {} catch (error) {} // return from the function if you have an error\n\n\n    if (disabled || !token) return toast.error(disabled);\n    if (error || !token) return toast.error(error); // get the data of the loggedin user\n\n    setCookie(\"token\", token);\n    setCookie(\"id\", id);\n    let result = await fetch(`${sessionapi}api/user`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    }).then(res => res.json());\n    let role = result.role;\n    console.log(result);\n\n    if (!result) {\n      logout();\n    }\n\n    let user = { ...result,\n      token,\n      role\n    };\n    updateSession({\n      user\n    }); // toast(`Welcome ${user.name}!`);\n  }\n\n  function logout() {\n    setLoggedin(false);\n    removeCookie(\"id\");\n    removeCookie(\"token\");\n    updateSession({\n      user: {\n        token: null\n      }\n    });\n  }\n\n  async function register(email, username, password) {\n    let req = {\n      username: username,\n      email: email,\n      password: password,\n      role: \"user\",\n      name: \"\",\n      lastname: \"\",\n      status: \"active\",\n      address: \"lebanon\",\n      phone: \"0\",\n      photo: \"kgOrcxjkELpYSGkSj2fsvRuAqICRZm1n5FUqyc3S.png\"\n    };\n    let body = {\n      \"username\": \"12\",\n      \"email\": \"omar\",\n      \"photo\": \"kgOrcxjkELpYSGkSj2fsvRuAqICRZm1n5FUqyc3S.png\",\n      password: password\n    };\n    console.log(req);\n    let result = await axios.post(`${sessionapi}api/uploadimage`, req);\n    console.log(result); // return from the function if you have an error\n    // if (error || !token) return toast.error(error);\n  }\n\n  const context = {\n    session,\n    actions: {\n      login,\n      logout,\n      register,\n      loggedin\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(SessionContext.Provider, {\n    value: context,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 133,\n    columnNumber: 5\n  }, this);\n}\n\n_s(SessionProvider, \"2zZoL39QQOWqw88HdYJwpmAaZOE=\");\n\n_c = SessionProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"SessionProvider\");","map":{"version":3,"sources":["/home/omar/codi/final/front/src/components/session/SessionProvider.js"],"names":["React","useState","useEffect","SessionContext","setCookie","getCookie","removeCookie","toast","axios","Redirect","sessionapi","SessionProvider","children","token","loggedin","setLoggedin","session","setValue","user","initializeSession","fetch","headers","Authorization","then","res","json","role","updateSession","nextSession","value","prevSession","login","email","password","error","disabled","id","result","console","log","logout","register","username","req","name","lastname","status","address","phone","photo","body","post","context","actions"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport SessionContext from \"./SessionContext\";\nimport { setCookie, getCookie, removeCookie } from \"../../cookies\";\nimport { toast } from \"react-toastify\";\nimport axios from \"axios\";\nimport { Redirect } from \"react-router\";\nimport sessionapi from '../API/sessionapi'\n\nexport default function SessionProvider({ children }) {\n  let token = getCookie(\"token\");\n  const [loggedin, setLoggedin] = useState(false);\n  const [session, setValue] = useState({\n    user: {\n      token: getCookie(\"token\"),\n    },\n  });\n\n  useEffect(() => {\n    function initializeSession() {\n      let token = getCookie(\"token\");\n      if (token)\n        fetch(`${sessionapi}api/user`, {\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        })\n          .then((res) => res.json())\n          .then((res) => {\n            if (!res) {\n              return <Redirect to=\"/account\" />;\n            }\n            let role=res.role\n\n            let user = { ...res, token ,role};\n            setLoggedin(true);\n            updateSession({ user });\n          });\n    }\n    initializeSession();\n  }, [token]);\n\n  function updateSession(nextSession) {\n    let value =\n      typeof nextSession === \"function\"\n        ? nextSession\n        : (prevSession) => ({ ...prevSession, ...nextSession });\n    setValue(value);\n  }\n\n  async function login({ email, password }) {\n\n    try {\n      \n    } catch (error) {\n      \n    }\n    \n   \n    // return from the function if you have an error\n    if (disabled || !token) return toast.error(disabled);\n\n    if (error || !token) return toast.error(error);\n\n    // get the data of the loggedin user\n    setCookie(\"token\", token);\n    setCookie(\"id\", id);\n\n    let result = await fetch(`${sessionapi}api/user`, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n    }).then((res) => res.json());\n    let role = result.role;\n    console.log(result);\n    if (!result) {\n      logout()\n    }\n\n    let user = { ...result, token, role };\n\n    updateSession({ user });\n    // toast(`Welcome ${user.name}!`);\n  }\n\n  function logout() {\n    setLoggedin(false);\n    removeCookie(\"id\");\n    removeCookie(\"token\");\n    updateSession({ user: { token: null } });\n\n  }\n  async function register(email, username, password) {\n    let req = {\n      username: username,\n      email: email,\n      password: password,\n      role: \"user\",\n      name: \"\",\n      lastname: \"\",\n      status: \"active\",\n      address: \"lebanon\",\n      phone: \"0\",\n      photo: \"kgOrcxjkELpYSGkSj2fsvRuAqICRZm1n5FUqyc3S.png\",\n\n    };\n    let body={\n      \"username\": \"12\",\n        \"email\": \"omar\",\n        \"photo\": \"kgOrcxjkELpYSGkSj2fsvRuAqICRZm1n5FUqyc3S.png\",\n        password: password,\n\n    }\n    console.log(req);\n    let result = await axios.post(`${sessionapi}api/uploadimage`, req);\n\n    console.log(result);\n\n    // return from the function if you have an error\n    // if (error || !token) return toast.error(error);\n  }\n\n  const context = {\n    session,\n    actions: {\n      login,\n      logout,\n      register,\n      loggedin,\n    },\n  };\n\n  return (\n    <SessionContext.Provider value={context}>\n      {children}\n    </SessionContext.Provider>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}